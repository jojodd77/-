# 项目交接文档

## 📋 项目概述

**项目名称**: 发音修正平台 (Pronunciation Correction Platform)  
**版本**: v1.0.0  
**交接日期**: 2025年1月  
**技术栈**: Next.js 14 + TypeScript + Tailwind CSS

## 🎯 项目功能

1. **TTS发音标注**: 根据输入文本和需要标注的词语，生成符合TTS系统要求的发音标注文本
2. **批量处理**: 支持Excel文件批量处理，自动标注多个样本
3. **模型切换**: 支持切换不同的大语言模型（Modelverse、百度千帆、OpenAI等）
4. **自动降级**: 当主API失败时，自动切换到备用API

## 🏗️ 项目结构

```
my-tool-platform/
├── app/                    # Next.js App Router
│   ├── api/               # API 路由
│   │   ├── correct/       # 单文本修正接口
│   │   ├── process-excel-stream/  # Excel批量处理（流式）
│   │   ├── get-models/    # 获取可用模型列表
│   │   └── ...
│   ├── correction/        # 单文本修正页面
│   ├── test-models/       # 模型测试页面（Excel批量处理）
│   └── ...
├── lib/                   # 核心库
│   ├── prompt.ts         # Prompt构建函数（核心）
│   ├── uminfer.ts        # Modelverse API调用
│   ├── baidu.ts          # 百度千帆API调用
│   └── ...
├── types/                 # TypeScript类型定义
├── components/            # React组件
└── public/               # 静态资源
```

## 🔑 核心文件说明

### 1. `lib/prompt.ts` - Prompt构建
- **功能**: 构建发送给大模型的Prompt
- **关键**: 这是整个系统的核心，决定了标注的准确性
- **当前版本**: TTS发音标注专家Prompt（精确版）

### 2. `lib/uminfer.ts` - Modelverse API
- **功能**: 调用Modelverse (UMinfer) API
- **特点**: 支持模型ID选择，自动JSON解析

### 3. `app/api/correct/route.ts` - 主API路由
- **功能**: 单文本修正接口
- **特点**: 支持多API自动降级（Modelverse → 百度千帆 → OpenAI）

### 4. `app/api/process-excel-stream/route.ts` - Excel批量处理
- **功能**: 流式处理Excel文件，实时返回进度
- **输入格式**: 
  - 第1列: 样本ID
  - 第2列: 输入文本
  - 第3列: 需要改写文本（逗号分隔）
  - 第4列: 期望文本
  - 第5列: 输出文本（自动填充）

## ⚙️ 环境配置

### 必需的环境变量

创建 `.env.local` 文件（参考 `env.example`）：

```bash
# Modelverse API（主要使用）
UMINFER_API_KEY=your_api_key
UMINFER_API_ID=your_model_id

# 百度千帆 API（备用）
BAIDU_API_KEY=your_baidu_key
BAIDU_SECRET_KEY=your_baidu_secret

# OpenAI API（备用）
OPENAI_API_KEY=your_openai_key

# 应用配置
NEXT_PUBLIC_APP_URL=http://localhost:3001
NODE_ENV=development
```

### 安装依赖

```bash
npm install
# 或
yarn install
# 或
pnpm install
```

### 运行开发服务器

```bash
npm run dev
# 访问 http://localhost:3001
```

### 构建生产版本

```bash
npm run build
npm start
```

## 🚀 部署说明

### Vercel 部署（推荐）

1. 将代码推送到 GitHub
2. 在 Vercel 中导入项目
3. 配置环境变量
4. 自动部署

### 其他平台

项目基于 Next.js，可部署到任何支持 Node.js 的平台：
- Vercel（推荐）
- Netlify
- Railway
- 自建服务器

## 📝 重要注意事项

### 1. API账户状态
- **Modelverse API**: 当前账户可能已逾期，需要充值
- **自动降级**: 系统会在Modelverse失败时自动切换到其他API
- **建议**: 配置多个API密钥以确保服务稳定

### 2. Prompt优化
- Prompt位于 `lib/prompt.ts`
- 这是影响准确性的关键因素
- 当前准确率约30%，可能需要进一步优化

### 3. 模型选择
- 系统支持切换不同模型
- 可通过 `/api/get-models` 获取可用模型列表
- 在页面中选择模型进行测试

### 4. Excel处理格式
- 必须严格按照5列格式：ID、输入文本、需要改写文本、期望文本、输出文本
- 需要改写文本使用逗号分隔多个词语
- 系统会自动填充第5列（输出文本）

## 🐛 已知问题

1. **准确率问题**: 当前Prompt准确率约30%，需要持续优化
2. **API账户**: Modelverse账户可能已逾期，需要充值
3. **多音字判断**: 部分多音字的读音判断可能不准确

## 📚 相关文档

- `README.md` - 项目基本说明
- `env.example` - 环境变量示例
- `lib/prompt.ts` - Prompt详细内容
- 其他文档文件在项目根目录

## 🔄 版本历史

- **v1.0.0** (当前): 完整功能版本
  - 单文本修正
  - Excel批量处理
  - 模型切换
  - 自动降级机制

## 📞 联系方式

如有问题，请查看项目文档或提交Issue。

---

**交接完成确认**: 
- [ ] 代码已提交到GitHub
- [ ] 环境变量已配置
- [ ] 依赖已安装
- [ ] 开发服务器可正常运行
- [ ] 生产构建成功

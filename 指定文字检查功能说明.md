# ✨ 指定文字检查功能说明

## 🎯 功能概述

在发音判断修正页面，新增了"指定要检查的文字"功能。用户可以：

1. **输入完整文本**：在第一个文本框中输入要检查的完整文本
2. **指定要检查的文字**：在第二个文本框中输入要检查的特定文字（可选）
3. **精确检查**：如果指定了文字，系统只会判断和修正这个文字在文本中的读音

## 📋 使用方法

### 方法 1：检查所有多音字（原有功能）

1. 在"输入文本"框中输入完整文本
2. "指定要检查的文字"框留空
3. 点击"判断并修正"
4. 系统会检查文本中的所有多音字

### 方法 2：只检查指定文字（新功能）

1. 在"输入文本"框中输入完整文本
   - 例如：`图中哪个光路图是正确的？人物传记创作的核心原则中，哪个原则是判断的关键呢？`
2. 在"指定要检查的文字"框中输入要检查的文字
   - 例如：`中`
3. 点击"判断并修正"
4. 系统只会检查"中"字在文本中的读音是否正确
   - 结果：`图中(/zhong1/)哪个光路图是正确的？人物传记创作的核心原则中(/zhong1/)，哪个原则是判断的关键呢？`

## 🔍 功能特点

### 1. 精确检查

- 如果指定了要检查的文字，系统**只检查这个文字**
- 其他多音字不会被检查或修正
- 结果更聚焦，更符合用户需求

### 2. 智能处理

- 如果文本中有多个相同的文字（如多个"中"），会检查所有出现的位置
- 根据上下文判断每个位置的正确读音
- 只修正需要修正的位置

### 3. 验证机制

- 如果指定的文字不在文本中，会提示错误
- 如果指定的文字在文本中读音正确，会显示"无需修正"
- 如果指定的文字需要修正，会显示修正结果

## 📝 示例

### 示例 1：检查"中"字

**输入文本**：
```
图中哪个光路图是正确的？直接选中了诸葛亮。
```

**指定要检查的文字**：
```
中
```

**结果**：
- 修正后文本：`图中(/zhong1/)哪个光路图是正确的？直接选中(/zhong4/)了诸葛亮。`
- 只修正了"中"字，其他文字不变

### 示例 2：检查"重"字

**输入文本**：
```
重庆是非常重要的城市，我们要重视这个问题。
```

**指定要检查的文字**：
```
重
```

**结果**：
- 修正后文本：`重(/chong2/)庆是非常重(/zhong4/)要的城市，我们要重(/zhong4/)视这个问题。`
- 只修正了"重"字的所有出现位置

### 示例 3：不指定文字（检查所有）

**输入文本**：
```
图中哪个光路图是正确的？让大家流口水解渴的？
```

**指定要检查的文字**：
```
（留空）
```

**结果**：
- 修正后文本：`图中(/zhong1/)哪个光路图是正确的？让大家流口水解(/jie3/)渴的？`
- 检查并修正了所有多音字

## 🎨 界面说明

### 输入区域

1. **输入文本**（必填）
   - 多行文本框
   - 支持中文和英文
   - 占位符提示：`例如：图中哪个光路图是正确的？`

2. **指定要检查的文字**（可选）
   - 单行文本框
   - 可以输入单个字符或多个字符
   - 占位符提示：`例如：中、重、解（留空则检查所有多音字）`
   - 提示文字：`如果填写，系统只会判断和修正这个文字在文本中的读音是否正确`

### 结果区域

- 如果指定了文字，结果会聚焦于该文字的修正
- 修正详情中只显示指定文字的修正
- 消息会明确说明检查的是哪个文字

## 🔧 技术实现

### 前端修改

- 添加了 `targetChar` 状态
- 添加了第二个输入框
- 修改了 API 请求，包含 `targetChar` 参数

### 后端修改

- API 路由支持 `targetChar` 参数
- Prompt 根据是否指定文字调整检查范围
- 大模型结果过滤，只保留指定文字的修正
- 规则引擎支持指定文字检查

### 处理流程

1. **接收请求**：检查 `targetChar` 是否在文本中
2. **调用大模型**：Prompt 中明确指定只检查某个文字
3. **过滤结果**：只保留指定文字的修正
4. **返回结果**：返回过滤后的修正结果

## ✅ 优势

1. **更精确**：用户可以精确指定要检查的文字
2. **更高效**：不需要检查所有多音字，处理更快
3. **更聚焦**：结果更清晰，只关注用户关心的文字
4. **更灵活**：可以选择检查所有或只检查特定文字

## 🧪 测试建议

请测试以下场景：

1. **指定单个字符**
   - 文本：`图中哪个光路图是正确的？`
   - 指定：`中`
   - 预期：只修正"中"字

2. **文本中有多个相同字符**
   - 文本：`图中哪个光路图是正确的？直接选中了。`
   - 指定：`中`
   - 预期：修正所有"中"字

3. **指定文字不在文本中**
   - 文本：`图中哪个光路图是正确的？`
   - 指定：`重`
   - 预期：提示错误

4. **不指定文字**
   - 文本：`图中哪个光路图是正确的？`
   - 指定：（留空）
   - 预期：检查所有多音字

## 📝 注意事项

1. **指定文字必须存在于文本中**
   - 如果指定的文字不在文本中，会返回错误

2. **可以指定多个字符**
   - 例如：可以指定 `中重` 来检查这两个字
   - 但建议一次只指定一个字符，更清晰

3. **留空则检查所有**
   - 如果不填写"指定要检查的文字"，系统会检查所有多音字

4. **结果聚焦**
   - 如果指定了文字，结果中只包含该文字的修正
   - 其他文字的修正会被过滤掉

功能已完成！现在可以测试了。🎉




# 🔧 500 错误修复指南

## 🔍 问题诊断

根据检查，500 错误可能由以下原因导致：

1. **开发服务器构建缓存问题**
2. **环境变量未配置**
3. **TypeScript 编译错误**
4. **依赖问题**

## ✅ 修复步骤

### 方法 1：使用自动修复脚本（推荐）

```bash
cd /Users/jojodd/my-tool-platform
./修复500错误.sh
```

这个脚本会自动：
- ✅ 检查并创建环境变量文件
- ✅ 停止当前开发服务器
- ✅ 清理构建缓存
- ✅ 检查依赖和编译错误
- ✅ 重新启动开发服务器

### 方法 2：手动修复步骤

#### 步骤 1：停止当前开发服务器

```bash
# 查找并停止占用 3001 端口的进程
lsof -ti :3001 | xargs kill -9

# 或者手动查找进程
ps aux | grep "next dev"
kill <PID>
```

#### 步骤 2：创建环境变量文件

```bash
cd /Users/jojodd/my-tool-platform

# 如果 .env.local 不存在，创建它
if [ ! -f .env.local ]; then
    cp env.example .env.local
    echo "✅ 已创建 .env.local"
fi
```

#### 步骤 3：清理构建缓存

```bash
# 删除 .next 目录
rm -rf .next

# 可选：清理 node_modules（如果依赖有问题）
# rm -rf node_modules package-lock.json
# npm install
```

#### 步骤 4：检查 TypeScript 编译

```bash
# 检查是否有编译错误
npx tsc --noEmit
```

如果有错误，根据错误信息修复代码。

#### 步骤 5：重新启动开发服务器

```bash
npm run dev
```

启动成功后，访问 http://localhost:3001

## 🐛 常见问题排查

### 问题 1：端口被占用

**症状**：`Error: listen EADDRINUSE: address already in use :::3001`

**解决**：
```bash
# 查找占用端口的进程
lsof -i :3001

# 停止进程
kill <PID>

# 或者使用其他端口
npm run dev -- -p 3002
```

### 问题 2：模块未找到

**症状**：`Cannot find module 'xxx'`

**解决**：
```bash
# 重新安装依赖
rm -rf node_modules package-lock.json
npm install
```

### 问题 3：TypeScript 类型错误

**症状**：编译时出现类型错误

**解决**：
1. 检查 `tsconfig.json` 配置
2. 修复代码中的类型错误
3. 运行 `npx tsc --noEmit` 查看详细错误

### 问题 4：环境变量未配置

**症状**：API 调用失败，提示环境变量未配置

**解决**：
1. 确保 `.env.local` 文件存在
2. 检查环境变量是否正确配置
3. 重启开发服务器使环境变量生效

## 📝 环境变量配置说明

项目需要以下环境变量（可选，不配置会使用模拟逻辑）：

```bash
# 智谱清言 API（推荐，免费）
ZHIPU_API_KEY=your_api_key_here

# 百度千帆 API（免费）
BAIDU_API_KEY=your_api_key_here
BAIDU_SECRET_KEY=your_secret_key_here

# OpenAI API（付费）
OPENAI_API_KEY=your_api_key_here
OPENAI_MODEL=gpt-4o-mini
```

**注意**：如果不配置任何 API Key，系统会使用模拟逻辑，功能仍然可以正常使用。

## 🔄 完整重置流程

如果以上方法都不行，尝试完整重置：

```bash
cd /Users/jojodd/my-tool-platform

# 1. 停止所有相关进程
lsof -ti :3001 | xargs kill -9

# 2. 清理所有缓存和依赖
rm -rf .next node_modules package-lock.json

# 3. 重新安装依赖
npm install

# 4. 创建环境变量文件
cp env.example .env.local

# 5. 重新启动
npm run dev
```

## ✅ 验证修复

修复后，检查以下内容：

1. **开发服务器正常启动**
   - 终端显示：`▲ Next.js 14.2.5`
   - 显示：`- Local: http://localhost:3001`

2. **页面可以访问**
   - 访问 http://localhost:3001
   - 页面正常显示，没有空白

3. **控制台没有错误**
   - 打开浏览器开发者工具（F12）
   - Console 标签页没有红色错误
   - Network 标签页请求都返回 200

## 📞 如果问题仍然存在

如果按照以上步骤操作后问题仍然存在：

1. **检查终端错误信息**
   - 查看开发服务器终端的完整错误日志
   - 复制错误信息

2. **检查浏览器控制台**
   - 打开开发者工具（F12）
   - 查看 Console 和 Network 标签页的错误

3. **检查代码**
   - 确认最近是否有代码修改
   - 检查是否有语法错误

4. **查看日志文件**
   - Next.js 会在终端显示详细错误信息
   - 注意查看完整的错误堆栈

## 💡 预防措施

为了避免将来出现类似问题：

1. **定期清理构建缓存**
   ```bash
   rm -rf .next
   ```

2. **保持依赖更新**
   ```bash
   npm update
   ```

3. **使用 Git 管理代码**
   - 提交前检查编译：`npm run build`
   - 提交前运行 Lint：`npm run lint`

4. **配置环境变量**
   - 确保 `.env.local` 文件存在
   - 不要将 `.env.local` 提交到 Git



